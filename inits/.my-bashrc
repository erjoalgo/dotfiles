#!/bin/bash

#emacs editor
export VISUAL='emacsclient'
export EDITOR='emacsclient'

#bash prompt

COLOR=$(python /dev/stdin <<EOF
COLORS="""
Black	0;30
Blue	0;34
Green	0;32
Cyan	0;36
Red	0;31
Purple	0;35
Brown	0;33
Blue	0;34
Green	0;32
Cyan	0;36
Purple	0;35
Brown	0;33
"""
colors_list=filter(bool, COLORS.split('\n'))

hostname_idx=reduce(lambda cum, c: cum+ord(c)*31, '$(hostname)', 0)
color=colors_list[hostname_idx%len(colors_list)]
print(color.split()[1])
EOF
)

export PS1="\[\033[${COLOR}m\]â–ˆ\[\033[00m\]\[\033[0;34m\][\h][\$?]$ \[\033[00m\]"

source ~/.bash_aliases #should already be sourced by original bashrc
for SRC in $(find -L ~/.bash-fns/ -type f); do
    source $SRC;
done

# bash completion on macos
if which brew > /dev/null 2>&1 && test -f $(brew --prefix)/etc/bash_completion; then
    . $(brew --prefix)/etc/bash_completion
fi

# don't put duplicate lines in the history.
# See bash(1) for more options
HISTCONTROL=ignoredups
# append to the history file, don't overwrite it
shopt -s histappend
# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
export HISTSIZE=100000
export HISTFILESIZE=100000000
# https://askubuntu.com/questions/80371/
export PROMPT_COMMAND='history -a'
# check the window size after each command and, if necessary, update the values of LINES and COLUMNS.
shopt -s checkwinsize

# git-notify-lagging-repos.sh ${HOME}/git/* | sponge &
{
  LAGGING=$(git-notify-lagging-repos.sh ${HOME}/git/* | grep "NOTPUBLISHED")
  printf '%s' "${LAGGING%%A}"
} &
disown %-

#!/bin/bash

#emacs editor
export VISUAL='emacsclient'
export EDITOR='emacsclient'

#bash prompt


COLORS=$(cat <<EOF
Black	0;30
Blue	0;34
Green	0;32
Cyan	0;36
Red	0;31
Purple	0;35
Brown	0;33
Blue	0;34
Green	0;32
Cyan	0;36
Red	0;31
Purple	0;35
Brown	0;33
EOF
)

HOSTNAME_HASH_IDX=$(python -c "import sys; print(reduce(lambda cum, c: cum+ord(c)*31, '$(hostname)', 0))")
COLOR_CNT=$(wc -l <<< "${COLORS}")
COLOR_IDX=$(expr ${HOSTNAME_HASH_IDX} % ${COLOR_CNT})
COLOR=$(head -n ${COLOR_IDX} <<< "${COLORS}" | tail -1 | cut -f2)

export PS1="\[\033[${COLOR}m\][\h]\$ \[\033[00m\]"

GNU_SCRIPTS="${HOME}/git/erjoalgo-gnu-scripts"

source ~/.bash_aliases #should already be sourced by original bashrc
source ~/.my-bash-funs #lnabs, findiregex, etc

# bash completion on macos
test -f $(brew --prefix)/etc/bash_completion &&  \
    . $(brew --prefix)/etc/bash_completion

#gnu scripts
export PATH=$PATH:/sbin:/usr/sbin:${HOME}/bin:${GNU_SCRIPTS}:${HOME}/.local/bin

#lisp
export LISP=sbcl

#python
export PYTHONSTARTUP=${HOME}/.pythonrc.py

ORACLE_JAVA=/usr/lib/jvm/jdk-8-oracle-x64
if test -z "${JAVA_HOME}" -a -d "${ORACLE_JAVA}"; then
    export JAVA_HOME="${ORACLE_JAVA}"
fi

export PATH

# don't put duplicate lines in the history.
# See bash(1) for more options
HISTCONTROL=ignoredups
# append to the history file, don't overwrite it
shopt -s histappend
# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
export HISTSIZE=100000
export HISTFILESIZE=100000000
# https://askubuntu.com/questions/80371/
export PROMPT_COMMAND='history -a'
# check the window size after each command and, if necessary, update the values of LINES and COLUMNS.
shopt -s checkwinsize

echo "lagging repos: "
git-notify-lagging-repos.sh ${HOME}/git/*

;; -*- mode: lisp; -*-
(in-package :stumpwm)

;; sbclrc gives us quickload
(load (merge-pathnames ".sbclrc" (user-homedir-pathname)))

(defun load-stumpwmrc-file (relative-path)
  (let ((source-directory
          (or *load-truename*
              (merge-pathnames #P".stumpwmrc.d/lisp/"
                               (user-homedir-pathname)))))
    (load (merge-pathnames relative-path source-directory))))

(load-stumpwmrc-file "erjoalgo-stumpwmrc.asd")
(ql:quickload :erjoalgo-stumpwmrc)
(swank-start)
(xinitrc-init)
(load-stumpwmrc-file "top-map-bindings.lisp") ;; TODO remove side-effects. add "init" method
(init-decorations)
(url-launcher-init)
(text-shortcuts-init)
(init-brightness)
(contacts:contacts-load)
(x-service-start 1959)
(def-thread-start *battery-notification-thread*
  (battery-info-check-notify-loop))
(def-thread-start *sms-fanout-reconnect-thread*
  (sms-fanout-client:reconnect-loop *sms-fanout-ws-address*))
;; (sb-thread:terminate-thread *sms-fanout-reconnect-thread*)
(setf *startup-message* nil)
(startup-apps-run)
